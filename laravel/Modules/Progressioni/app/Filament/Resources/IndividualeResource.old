<?php

declare(strict_types=1);

namespace Modules\Performance\Filament\Resources;

use Filament\Forms;
use Filament\Tables;
use function Safe\date;
use Filament\Forms\Form;
use Filament\Tables\Table;
use Filament\Tables\Columns\TextColumn;
use Filament\Tables\Enums\FiltersLayout;
use Filament\Tables\Filters\SelectFilter;
use Modules\Performance\Enums\WorkerType;
use Filament\Tables\Enums\ActionsPosition;
use Modules\Performance\Models\Individuale;
use Modules\UI\Filament\Tables\Columns\GroupColumn;

use Modules\Xot\Filament\Resources\XotBaseResource;
use Modules\Performance\Filament\Resources\IndividualeResource\Pages;

class IndividualeResource extends XotBaseResource
{
    protected static ?string $model = Individuale::class;

    protected static ?string $navigationIcon = 'heroicon-o-rectangle-stack';

    public static function form(Form $form): Form
    {
        return $form->schema(
            [
                Forms\Components\TextInput::make('type')
                    ->maxLength(50),

                Forms\Components\TextInput::make('ente')
                    ->required()
                    ->numeric()
                    ->default(0),
                Forms\Components\TextInput::make('matr')
                    ->numeric(),
                Forms\Components\TextInput::make('cognome')
                    ->maxLength(250),
                Forms\Components\TextInput::make('nome')
                    ->maxLength(250),
                Forms\Components\TextInput::make('email')
                    ->email()
                    ->maxLength(250),
                Forms\Components\TextInput::make('stabi')
                    ->numeric(),
                Forms\Components\TextInput::make('repar')
                    ->numeric(),
                Forms\Components\TextInput::make('stabival')
                    ->numeric(),
                Forms\Components\TextInput::make('reparval')
                    ->numeric(),
                Forms\Components\TextInput::make('stabi_txt')
                    ->maxLength(250),
                Forms\Components\TextInput::make('repar_txt')
                    ->maxLength(250),
                Forms\Components\TextInput::make('disci')
                    ->numeric(),
                Forms\Components\TextInput::make('disci_txt')
                    ->maxLength(100),
                Forms\Components\TextInput::make('rep2kd')
                    ->numeric(),
                Forms\Components\TextInput::make('rep2ka')
                    ->numeric(),
                Forms\Components\TextInput::make('posiz')
                    ->numeric(),
                Forms\Components\TextInput::make('propro')
                    ->numeric(),
                Forms\Components\TextInput::make('posfun')
                    ->numeric(),
                Forms\Components\TextInput::make('categoria_eco')
                    ->maxLength(50),
                Forms\Components\TextInput::make('qua2kd')
                    ->numeric(),
                Forms\Components\TextInput::make('qua2ka')
                    ->numeric(),
                Forms\Components\TextInput::make('dal')
                    ->numeric(),
                Forms\Components\TextInput::make('al')
                    ->numeric(),
                Forms\Components\TextInput::make('anno')
                    ->numeric(),
                Forms\Components\TextInput::make('giornitempodet')
                    ->numeric(),
                Forms\Components\TextInput::make('ha_diritto')
                    ->numeric(),
                Forms\Components\TextInput::make('motivo')
                    ->maxLength(250),
                Forms\Components\TextInput::make('esperienza_acquisita')
                    ->numeric(),
                Forms\Components\TextInput::make('risultati_ottenuti')
                    ->numeric(),
                Forms\Components\TextInput::make('arricchimento_professionale')
                    ->numeric(),
                Forms\Components\TextInput::make('impegno')
                    ->numeric(),
                Forms\Components\TextInput::make('qualita_prestazione')
                    ->numeric(),
                Forms\Components\TextInput::make('totale_punteggio')
                    ->numeric(),
                Forms\Components\TextInput::make('lista_auth')
                    ->maxLength(250),
                Forms\Components\TextInput::make('peso_esperienza_acquisita')
                    ->numeric(),
                Forms\Components\TextInput::make('peso_risultati_ottenuti')
                    ->numeric(),
                Forms\Components\TextInput::make('peso_arricchimento_professionale')
                    ->numeric(),
                Forms\Components\TextInput::make('peso_impegno')
                    ->numeric(),
                Forms\Components\TextInput::make('peso_qualita_prestazione')
                    ->numeric(),
                Forms\Components\DateTimePicker::make('datemod'),
                Forms\Components\Textarea::make('note')
                    ->columnSpanFull(),
                Forms\Components\TextInput::make('oree')
                    ->numeric(),
                Forms\Components\TextInput::make('oret')
                    ->numeric(),
                Forms\Components\TextInput::make('perc_parttime')
                    ->numeric(),
                Forms\Components\TextInput::make('perc_parttimepond')
                    ->numeric(),
                Forms\Components\TextInput::make('gg_parttimevert')
                    ->numeric(),
                Forms\Components\TextInput::make('ore_assenza')
                    ->numeric(),
                Forms\Components\TextInput::make('giorni_assenza')
                    ->numeric(),
                Forms\Components\TextInput::make('giorni_presenza')
                    ->numeric(),
                Forms\Components\TextInput::make('categ_coeff')
                    ->numeric(),
                Forms\Components\TextInput::make('quota_teorica')
                    ->numeric(),
                Forms\Components\TextInput::make('budget_assegnato')
                    ->numeric(),
                Forms\Components\TextInput::make('quota_effettiva')
                    ->numeric(),
                Forms\Components\TextInput::make('resti')
                    ->numeric(),
                Forms\Components\TextInput::make('resti_pond')
                    ->numeric(),
                Forms\Components\TextInput::make('importo_totale')
                    ->numeric(),
                Forms\Components\TextInput::make('gg_totale_sigma')
                    ->numeric(),
                Forms\Components\TextInput::make('gg_validi_sigma')
                    ->numeric(),
                Forms\Components\TextInput::make('gg_assenz_sigma')
                    ->numeric(),
                Forms\Components\TextInput::make('decurtazione_perc')
                    ->numeric(),
                Forms\Components\TextInput::make('gg_tempo_determinato')
                    ->numeric(),
                Forms\Components\TextInput::make('gg_posiz_1_in_sede')
                    ->numeric(),
                Forms\Components\TextInput::make('gg_assenza_anno')
                    ->numeric(),
                Forms\Components\TextInput::make('gg_presenza_anno')
                    ->numeric(),
                Forms\Components\TextInput::make('ore_assenza_anno')
                    ->numeric(),
                Forms\Components\TextInput::make('posiz_txt')
                    ->maxLength(255),
                Forms\Components\TextInput::make('clafun')
                    ->numeric(),
                Forms\Components\TextInput::make('disci1')
                    ->numeric(),
                Forms\Components\TextInput::make('disci1_txt')
                    ->maxLength(255),
                Forms\Components\TextInput::make('gg_ruolo')
                    ->numeric(),
                Forms\Components\TextInput::make('last_data_assunz')
                    ->numeric(),
                Forms\Components\TextInput::make('perc_parttime_anno')
                    ->numeric(),
                Forms\Components\TextInput::make('perc_parttime_dalal')
                    ->numeric(),
                Forms\Components\TextInput::make('gg_parttimevert_anno')
                    ->numeric(),
                Forms\Components\TextInput::make('gg_parttimevert_dalal')
                    ->numeric(),
                Forms\Components\TextInput::make('perc_parttimepond_anno')
                    ->numeric(),
                Forms\Components\TextInput::make('perc_parttimepond_dalal')
                    ->numeric(),
                Forms\Components\TextInput::make('gg_presenza_dalal')
                    ->numeric(),
                Forms\Components\TextInput::make('gg_assenza_dalal')
                    ->numeric(),
                Forms\Components\TextInput::make('hh_assenza_anno')
                    ->numeric(),
                Forms\Components\TextInput::make('hh_assenza_dalal')
                    ->numeric(),
                Forms\Components\TextInput::make('lang')
                    ->maxLength(3),
                Forms\Components\Toggle::make('excellence'),
                Forms\Components\TextInput::make('codqua')
                    ->numeric(),
                Forms\Components\TextInput::make('cont')
                    ->numeric(),
                Forms\Components\TextInput::make('tipco')
                    ->numeric(),
                Forms\Components\TextInput::make('posizione_eco')
                    ->maxLength(191),
                Forms\Components\TextInput::make('gg_anno')
                    ->required()
                    ->numeric(),
            ]);
    }

    public static function table(Table $table): Table
    {
        return $table->columns(
            [/*
    Tables\Columns\TextColumn::make('type')
    ->searchable(),
    */

                GroupColumn::make('lavoratore')->schema([
                    TextColumn::make('matr')->searchable(),
                    TextColumn::make('cognome')->searchable(),
                    TextColumn::make('nome'),
                    TextColumn::make('email'),
                    TextColumn::make('totale_punteggio'),
                ]),
                GroupColumn::make('qua')->schema([
                    TextColumn::make('propro'),
                    TextColumn::make('posfun'),
                    TextColumn::make('categoria_eco'),
                    TextColumn::make('categoria_ecoval'),
                    TextColumn::make('posfunval'),
                    TextColumn::make('posiz'),
                    TextColumn::make('posiz_txt'),
                    TextColumn::make('disci1'),
                    TextColumn::make('disci1_txt'),
                ]),
                GroupColumn::make('rep')->schema([
                    TextColumn::make('stabi'),
                    TextColumn::make('stabi_txt'),
                    TextColumn::make('repar'),
                    TextColumn::make('repar_txt'),
                ]),
                GroupColumn::make('periodo')->schema([
                    TextColumn::make('dal'),
                    TextColumn::make('al'),
                    TextColumn::make('anno'),
                ]),
            ])
            ->filters([
                app(\Modules\Xot\Actions\Filament\Filter\GetYearFilter::class)->execute('anno', intval(date('Y')) - 3, intval(date('Y'))),
                SelectFilter::make('type')
                    ->options(WorkerType::class),
            ])
                ->filtersLayout(FiltersLayout::AboveContent)
                ->persistFiltersInSession()
            ->actions([
                Tables\Actions\EditAction::make(),
            ], position: ActionsPosition::BeforeColumns)
            ->bulkActions([
                Tables\Actions\BulkActionGroup::make([
                    Tables\Actions\DeleteBulkAction::make(),
                ]),
            ]);
    }

    public static function getRelations(): array
    {
        return [
        ];
    }

    public static function getPages(): array
    {
        return [
            'index' => Pages\ListIndividuales::route('/'),
            'create' => Pages\CreateIndividuale::route('/create'),
            'edit' => Pages\EditIndividuale::route('/{record}/edit'),
        ];
    }
}
