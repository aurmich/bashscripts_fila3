@php
    if(!isset($year)){
        $year=date('Y');
    }
@endphp
<nav aria-label="month year navigation">
<form method="get">
  	<ul class="pagination justify-content-center">
		<li>

			{{ Form::bsSelect('stabi',request('stabi'),
				[
				'options'=>$nav['options'],
				'class'=>'form-control hierselect',
				'data-url'=>url('/admin/sigma/it/repart'),
				'data-idhier'=>'repar',
				])
			}}

		{{--
		<select class="form-control hierselect" data-url="{{ url('/admin/sigma/it/repart') }}" data-idhier="sec" name="stabi">
		@foreach($nav['options'] as $k=>$v)
			<option value="{{ $k }}">{{ $v }}</option>
		@endforeach
		</select>
		 --}}
		</li>
		<li>
			{{--
			<select id="sec" class="form-control" name="repar"></select>
			--}}
			{{ Form::bsSelect('repar',request('repar'),
				[
					'id'=>'repar',
				])
			}}
		</li>
		<li>
			{{--
			<input type="text" name="year" value="{{ date('Y') }}" class="form-control">
            --}}


			{{ Form::bsText('year',Request::input('year',$year)) }}
		<li>
		<li>
			<br/>
			<button type="submit" class="btn btn-info">
				<i class="fas fa-filter"></i>
			</button>
		</li>
	</ul>
</form>
</nav>

@push('scripts')
<script>
$(document).ready(function($){
	$('.hierselect').each(function( index ) {
		var $this=$(this);
		hierx($this);
	});
	$('.hierselect').change(function(){
		var $this=$(this);
		hierx($this);
	});
});


function hierx($this){
	//console.log('hierx');
	var $url=$this.data('url');
	//console.log($url);
	var $idhier=$this.data('idhier');
	$.ajax({
		method: "GET",
		dataType: "json",
		url:$url,
		data:{ stabi: $this.val(), format:'json' }
	}).done(function(response) {
		//console.log(response);
		var model = $('#'+$idhier);
		model.empty();
		$.each(response.data, function(index, el) {
			//console.log(el);
			model.append("<option value='"+ el.repar +"'>" + el.repar + '] '+el.dest1 + "</option>");
		});
		//console.log(model.attr('name'));
		/*
		$name1=$this.attr('name');
		$val1=qs($name1);
		$this.val($val1).change();
		//*/
		$name2=model.attr('name');
		$val2=qs($name2);
		model.val($val2).change();
		//*/
	});
};

function qs(key) {
    key = key.replace(/[*+?^$.\[\]{}()|\\\/]/g, "\\$&"); // escape RegEx meta chars
    var match = location.search.match(new RegExp("[?&]"+key+"=([^&]+)(&|$)"));
    return match && decodeURIComponent(match[1].replace(/\+/g, " "));
}


</script>
@endpush
